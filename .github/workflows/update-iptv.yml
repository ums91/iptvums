name: Auto Update IPTV Playlist

on:
  schedule:
    # Runs every 3 days at 03:00 UTC
    - cron: "0 3 */3 * *"
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download and extract IPTV playlist
        run: |
          set -e
          mkdir -p playlists
          curl -L https://iptv-org.github.io/iptv/index.m3u \
          | awk 'NR==1 || $0 !~ /^#EXTM3U/' \
          > playlists/all-channels.m3u

      - name: Commit and push if changed
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add playlists/all-channels.m3u
          git commit -m "Auto-update IPTV playlist (3-day sync)" || exit 0
          git push
